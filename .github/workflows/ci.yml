name: CI

on:
  push:
    branches:
      - master
  pull_request:
  workflow_dispatch:

jobs:
  init:
    name: Initialise
    uses: ./.github/workflows/init.yml
    secrets: inherit

  lint-and-test:
    name: Lint & Test
    runs-on: ubuntu-latest
    needs: init
    env:
      CI: true
    steps:
      - name: ESLint
        run: pnpm lint:eslint

      - name: Prettier
        run: pnpm lint:prettier

      - name: TypeScript
        run: pnpm lint:tsc

      - name: Build
        run: pnpm build

      - name: Package fixtures
        run: pnpm fixtures --aggregate-output package

      - name: Install Browsers
        run: pnpm playwright install chromium

      - name: Test
        run: pnpm test
